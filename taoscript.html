<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>üîß Bookmarklet Generator - 2 C·ªôt</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #00ffff;
      margin-bottom: 30px;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .column {
      flex: 1;
      min-width: 400px;
      background: #1a1a1a;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #333;
    }
    h2 {
      color: #00ffaa;
    }
    textarea {
      width: 100%;
      height: 180px;
      margin-bottom: 15px;
      font-family: monospace;
      background: #222;
      color: #0f0;
      border: 1px solid #444;
      padding: 10px;
      resize: vertical;
    }
    button {
      padding: 10px 20px;
      font-weight: bold;
      background: #28a745;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      margin-bottom: 15px;
    }
    button:hover {
      background: #218838;
    }
    @media (max-width: 900px) {
      .container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <h1>üîß Tr√¨nh T·∫°o Bookmarklet T·ª± ƒê·ªông</h1>

  <div class="container">

    <!-- C·ªòT 1 -->
    <div class="column">
      <h2>1Ô∏è‚É£ T·ª± ƒë·ªông g·∫Øn URL v√†o script g·ªëc</h2>
      <h4>üîπ Nh·∫≠p ƒëo·∫°n bookmarklet c√≥ ch·ª©a URL:</h4>
      <textarea id="inputB1" placeholder="D√°n ƒëo·∫°n javascript:(()=>{s.src='https://...';..."></textarea>
      <button onclick="generateA1()">üîÑ T·∫°o l·∫°i Script</button>
      <h4>‚úÖ K·∫øt qu·∫£ Script:</h4>
      <textarea id="outputA1" readonly></textarea>
    </div>

    <!-- C·ªòT 2 -->
    <div class="column">
      <h2>2Ô∏è‚É£ T·ª± ƒë·ªông g·∫Øn Base64 v√†o script gi·∫£i m√£</h2>
      <h4>üîπ Nh·∫≠p ƒëo·∫°n m√£ Base64:</h4>
      <textarea id="inputB2" placeholder="D√°n ƒëo·∫°n m√£ Base64 c·ªßa script..."></textarea>
      <button onclick="generateA2()">üîÑ T·∫°o l·∫°i Script</button>
      <h4>‚úÖ K·∫øt qu·∫£ Script:</h4>
      <textarea id="outputA2" readonly></textarea>
    </div>

  </div>

  <script>
    // CH·ª®C NƒÇNG 1: Tr√≠ch xu·∫•t URL t·ª´ ƒëo·∫°n js
    function extractURL(jsString) {
      const match = jsString.match(/s\.src\s*=\s*['"]([^'"]+)['"]/);
      return match ? match[1] : null;
    }

    function generateA1() {
      const inputB = document.getElementById("inputB1").value;
      const extractedURL = extractURL(inputB);

      if (!extractedURL) {
        alert("‚ùå Kh√¥ng t√¨m th·∫•y URL trong khung B!");
        return;
      }

      const outputCode = `javascript:(async()=>{
  try {
    const t = new URL(location.href).searchParams.get("t");
    if (!t) return alert("‚ùå Kh√¥ng t√¨m th·∫•y tham s·ªë t= tr√™n URL!");

    const response = await fetch("https://hoathinh3d.site/?t=" + t, { credentials: "include" });
    const html = await response.text();

    const userIdMatch = html.match(/"user_id"\\s*:\\s*"(\d+)"/);
    const userId = userIdMatch ? userIdMatch[1] : null;
    if (!userId) return alert("‚ùå Kh√¥ng t√¨m th·∫•y user_id!");

    const verifyRes = await fetch("https://id-checker-server-production.up.railway.app/verify", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ gameId: userId })
    });

    const result = await verifyRes.json();
    if (!verifyRes.ok || !result.allowed) {
      return alert("üö´ Kh√¥ng ƒë∆∞·ª£c ph√©p ch·∫°y script: " + (result.reason || "Kh√¥ng r√µ l√Ω do"));
    }

    const s = document.createElement("script");
    s.src = "${extractedURL}";
    document.body.appendChild(s);
  } catch (err) {
    alert("‚ö†Ô∏è L·ªói khi ki·ªÉm tra ID ho·∫∑c k·∫øt n·ªëi.");
    console.error(err);
  }
})();`;

      document.getElementById("outputA1").value = outputCode;
    }

    // CH·ª®C NƒÇNG 2: G·∫Øn Base64 v√†o tr√¨nh gi·∫£i m√£
    function generateA2() {
      const base64 = document.getElementById("inputB2").value.trim();
      if (!base64 || base64.length < 10) {
        alert("‚ùå M√£ Base64 kh√¥ng h·ª£p l·ªá!");
        return;
      }

      const outputCode = `(function(){
  const encoded = '${base64}';

  function base64ToUtf8(base64) {
    const binary = atob(base64);
    const bytes = Uint8Array.from(binary, c => c.charCodeAt(0));
    return new TextDecoder('utf-8').decode(bytes);
  }

  try {
    const decoded = base64ToUtf8(encoded);
    const script = document.createElement('script');
    script.charset = "utf-8";
    script.textContent = decoded;
    document.body.appendChild(script);
  } catch(e) {
    console.clear();
    alert('üö´ L·ªói gi·∫£i m√£ UTF-8 ho·∫∑c d·ªØ li·ªáu!');
    window.location.reload();
  }
})();`;

      document.getElementById("outputA2").value = outputCode;
    }
  </script>

</body>
</html>
